{"ast":null,"code":"import { UsuarioService } from '../../services/login/usuario.service';\nimport { Usuario } from '../../models/usuario';\nimport * as sha256 from 'js-sha256';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"../../services/login/usuario.service\";\nimport * as i2 from \"@angular/router\";\nimport * as i3 from \"ngx-spinner\";\nimport * as i4 from \"src/app/services/comunicacion/comunicacion.service\";\nimport * as i5 from \"ngx-toastr\";\nimport * as i6 from \"@angular/common\";\nimport * as i7 from \"@angular/forms\";\nimport * as i8 from \"@ng-bootstrap/ng-bootstrap\";\nconst _c0 = (a0, a1) => ({\n  \"is-invalid\": a0,\n  \"is-valid\": a1\n});\nfunction UsuarioComponent_div_18_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtext(1, \" Email requerido \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction UsuarioComponent_div_18_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtext(1, \" Email invalido \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction UsuarioComponent_div_18_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 20);\n    i0.ɵɵtemplate(1, UsuarioComponent_div_18_div_1_Template, 2, 0, \"div\", 21)(2, UsuarioComponent_div_18_div_2_Template, 2, 0, \"div\", 21);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    i0.ɵɵnextContext();\n    const mail_r3 = i0.ɵɵreference(17);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", mail_r3.errors.required);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", mail_r3.errors.email);\n  }\n}\nfunction UsuarioComponent_div_26_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtext(1, \" Contrase\\u00F1a requerida. \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction UsuarioComponent_div_26_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 20);\n    i0.ɵɵtemplate(1, UsuarioComponent_div_26_div_1_Template, 2, 0, \"div\", 21);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    i0.ɵɵnextContext();\n    const contrasena_r4 = i0.ɵɵreference(25);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", contrasena_r4.errors.required);\n  }\n}\nfunction UsuarioComponent_small_27_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"small\", 22);\n    i0.ɵɵlistener(\"click\", function UsuarioComponent_small_27_Template_small_click_0_listener() {\n      i0.ɵɵrestoreView(_r5);\n      const ctx_r5 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r5.recuperarContrasena());\n    });\n    i0.ɵɵtext(1, \" Olvid\\u00E9 mi contrase\\u00F1a\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction UsuarioComponent_div_28_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 23);\n    i0.ɵɵtext(1, \" Error al iniciar sesi\\u00F3n. Por favor verifique los datos ingresados. \");\n    i0.ɵɵelementEnd();\n  }\n}\nexport let UsuarioComponent = /*#__PURE__*/(() => {\n  class UsuarioComponent {\n    constructor(usuarioService, router, spinner, comunicacionService, toastr) {\n      this.usuarioService = usuarioService;\n      this.router = router;\n      this.spinner = spinner;\n      this.comunicacionService = comunicacionService;\n      this.toastr = toastr;\n      this.loginEsInvalido = false;\n    }\n    ngOnInit() {}\n    ingresar(usuarioForm) {\n      this.spinner.show();\n      if (usuarioForm.valid) {\n        var mail = usuarioForm.value.mail;\n        var contrasena = sha256.sha256(usuarioForm.value.contrasena);\n        var datosValidos;\n        this.usuarioService.login(mail, contrasena).subscribe(res => {\n          this.spinner.hide();\n          datosValidos = res;\n          if (datosValidos) {\n            this.usuarioService.getUsuarioByEmail(mail).subscribe(res => {\n              var usuarioLogueado = res;\n              this.comunicacionService.enviarUsuario(usuarioLogueado);\n              localStorage.setItem('rolUsuario', usuarioLogueado.rolDeUsuario);\n              localStorage.setItem('emailUsuario', mail);\n              if (usuarioLogueado.rolDeUsuario == 'ADMINISTRATIVO') {\n                this.router.navigate([\"/inicio/restricciones\"]);\n              } else if (usuarioLogueado.rolDeUsuario == 'SUPERVISOR') {\n                this.router.navigate([\"/inicio/administrarRestricciones\"]);\n              }\n            });\n          } else this.setLoginInvalido();\n        });\n      }\n    }\n    getUsuarios() {\n      this.usuarioService.getUsuarios().subscribe(res => {\n        this.usuarioService.usuarios = res;\n        console.log(res);\n      });\n    }\n    setLoginInvalido() {\n      this.loginEsInvalido = true;\n      setTimeout(() => {\n        this.loginEsInvalido = false;\n      }, 5000);\n    }\n    recuperarContrasena() {\n      if (this.usuarioService.usuarioSeleccionado.email != \"\") {\n        let usuario = new Usuario();\n        usuario.email = this.usuarioService.usuarioSeleccionado.email;\n        usuario.rolDeUsuario = 'ADMINISTRATIVO';\n        if (confirm(\"Una nueva contraseña se enviará al email ingresado. ¿Desea continuar?\")) {\n          this.spinner.show();\n          this.usuarioService.recuperarContrasena(usuario).subscribe(res => {\n            let error = res;\n            this.spinner.hide();\n            if (error.hayError) {\n              this.toastr.error(\"\" + error.mensajeError, \"Error!\");\n            } else {\n              this.toastr.success('Nueva contraseña enviada al email', 'Enviada!');\n            }\n          });\n        }\n      }\n    }\n    static #_ = this.ɵfac = function UsuarioComponent_Factory(t) {\n      return new (t || UsuarioComponent)(i0.ɵɵdirectiveInject(i1.UsuarioService), i0.ɵɵdirectiveInject(i2.Router), i0.ɵɵdirectiveInject(i3.NgxSpinnerService), i0.ɵɵdirectiveInject(i4.ComunicacionService), i0.ɵɵdirectiveInject(i5.ToastrService));\n    };\n    static #_2 = this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n      type: UsuarioComponent,\n      selectors: [[\"app-usuario\"]],\n      features: [i0.ɵɵProvidersFeature([UsuarioService])],\n      decls: 32,\n      vars: 15,\n      consts: [[\"usuarioForm\", \"ngForm\"], [\"mail\", \"ngModel\"], [\"contrasena\", \"ngModel\"], [1, \"container\"], [\"type\", \"ball-pulse-sync\", \"size\", \"medium\", \"bdColor\", \"rgba(51,51,51,0.5)\"], [2, \"font-size\", \"15px\", \"font-weight\", \"bold\", \"color\", \"white\"], [1, \"col-4\", \"mx-auto\"], [1, \"card\", \"border-primary\", \"mb-3\", \"text-center\"], [1, \"card-header\"], [1, \"card-body\"], [\"novalidate\", \"\", 3, \"ngSubmit\"], [1, \"form-group\"], [1, \"large\", \"material-icons\"], [\"type\", \"email\", \"ngbTooltip\", \"Ingrese su email\", \"placeholder\", \"Email\", \"name\", \"mail\", \"pattern\", \"[a-z0-9._%+-]+@[a-z0-9.-]+\\\\.[a-z]{2,4}$\", \"required\", \"\", \"email\", \"\", 1, \"form-control\", 3, \"ngModelChange\", \"ngClass\", \"ngModel\"], [\"class\", \"invalid-feedback d-block\", 4, \"ngIf\"], [1, \"form-text\", \"text-muted\"], [\"type\", \"password\", \"placeholder\", \"Password\", \"name\", \"contrasena\", \"ngbTooltip\", \"Contrase\\u00F1a\", \"required\", \"\", 1, \"form-control\", 3, \"ngModelChange\", \"ngClass\", \"ngModel\"], [\"id\", \"forgotPassword\", \"class\", \"form-text text-muted\", 3, \"click\", 4, \"ngIf\"], [\"class\", \"alert alert-danger\", \"role\", \"alert\", 4, \"ngIf\"], [1, \"btn\", \"btn-primary\", 3, \"disabled\"], [1, \"invalid-feedback\", \"d-block\"], [4, \"ngIf\"], [\"id\", \"forgotPassword\", 1, \"form-text\", \"text-muted\", 3, \"click\"], [\"role\", \"alert\", 1, \"alert\", \"alert-danger\"]],\n      template: function UsuarioComponent_Template(rf, ctx) {\n        if (rf & 1) {\n          const _r1 = i0.ɵɵgetCurrentView();\n          i0.ɵɵelementStart(0, \"div\", 3)(1, \"ngx-spinner\", 4)(2, \"p\", 5);\n          i0.ɵɵtext(3, \"Cargando...\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(4, \"div\", 6)(5, \"div\", 7)(6, \"div\", 8)(7, \"legend\");\n          i0.ɵɵtext(8, \"Iniciar Sesi\\u00F3n\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(9, \"div\", 9)(10, \"form\", 10, 0);\n          i0.ɵɵlistener(\"ngSubmit\", function UsuarioComponent_Template_form_ngSubmit_10_listener() {\n            i0.ɵɵrestoreView(_r1);\n            const usuarioForm_r2 = i0.ɵɵreference(11);\n            return i0.ɵɵresetView(ctx.ingresar(usuarioForm_r2));\n          });\n          i0.ɵɵelementStart(12, \"fieldset\")(13, \"div\", 11)(14, \"i\", 12);\n          i0.ɵɵtext(15, \"person\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(16, \"input\", 13, 1);\n          i0.ɵɵtwoWayListener(\"ngModelChange\", function UsuarioComponent_Template_input_ngModelChange_16_listener($event) {\n            i0.ɵɵrestoreView(_r1);\n            i0.ɵɵtwoWayBindingSet(ctx.usuarioService.usuarioSeleccionado.email, $event) || (ctx.usuarioService.usuarioSeleccionado.email = $event);\n            return i0.ɵɵresetView($event);\n          });\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(18, UsuarioComponent_div_18_Template, 3, 2, \"div\", 14);\n          i0.ɵɵelementStart(19, \"small\", 15);\n          i0.ɵɵtext(20, \"Ingrese Email\");\n          i0.ɵɵelementEnd()();\n          i0.ɵɵelementStart(21, \"div\", 11)(22, \"i\", 12);\n          i0.ɵɵtext(23, \"https\");\n          i0.ɵɵelementEnd();\n          i0.ɵɵelementStart(24, \"input\", 16, 2);\n          i0.ɵɵtwoWayListener(\"ngModelChange\", function UsuarioComponent_Template_input_ngModelChange_24_listener($event) {\n            i0.ɵɵrestoreView(_r1);\n            i0.ɵɵtwoWayBindingSet(ctx.usuarioService.usuarioSeleccionado.contrasena, $event) || (ctx.usuarioService.usuarioSeleccionado.contrasena = $event);\n            return i0.ɵɵresetView($event);\n          });\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(26, UsuarioComponent_div_26_Template, 2, 1, \"div\", 14)(27, UsuarioComponent_small_27_Template, 2, 0, \"small\", 17);\n          i0.ɵɵelementEnd();\n          i0.ɵɵtemplate(28, UsuarioComponent_div_28_Template, 2, 0, \"div\", 18);\n          i0.ɵɵelementStart(29, \"div\", 11)(30, \"button\", 19);\n          i0.ɵɵtext(31, \"Ingresar\");\n          i0.ɵɵelementEnd()()()()()()()();\n        }\n        if (rf & 2) {\n          const usuarioForm_r2 = i0.ɵɵreference(11);\n          const mail_r3 = i0.ɵɵreference(17);\n          const contrasena_r4 = i0.ɵɵreference(25);\n          i0.ɵɵadvance(16);\n          i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction2(9, _c0, mail_r3.invalid && mail_r3.touched, mail_r3.valid));\n          i0.ɵɵtwoWayProperty(\"ngModel\", ctx.usuarioService.usuarioSeleccionado.email);\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"ngIf\", mail_r3.invalid && (mail_r3.dirty || mail_r3.touched));\n          i0.ɵɵadvance(6);\n          i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction2(12, _c0, contrasena_r4.invalid && contrasena_r4.touched, contrasena_r4.valid));\n          i0.ɵɵtwoWayProperty(\"ngModel\", ctx.usuarioService.usuarioSeleccionado.contrasena);\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"ngIf\", contrasena_r4.invalid && (contrasena_r4.dirty || contrasena_r4.touched));\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", mail_r3.valid);\n          i0.ɵɵadvance();\n          i0.ɵɵproperty(\"ngIf\", ctx.loginEsInvalido);\n          i0.ɵɵadvance(2);\n          i0.ɵɵproperty(\"disabled\", !usuarioForm_r2.valid);\n        }\n      },\n      dependencies: [i6.NgClass, i6.NgIf, i7.ɵNgNoValidate, i7.DefaultValueAccessor, i7.NgControlStatus, i7.NgControlStatusGroup, i7.RequiredValidator, i7.PatternValidator, i7.EmailValidator, i7.NgModel, i7.NgForm, i8.NgbTooltip, i3.NgxSpinnerComponent],\n      styles: [\".container[_ngcontent-%COMP%]{margin-top:10%}.form-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding-left:40px}.form-group[_ngcontent-%COMP%]{position:relative}.form-group[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{position:absolute;left:0;padding:8px;color:#aaa}#forgotPassword[_ngcontent-%COMP%]{cursor:pointer}\"]\n    });\n  }\n  return UsuarioComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}